{% extends 'base.html' %}
{% block title %}
Diagnosis
{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Page Title -->
    <h2 class="text-center fw-bold mb-3" style="color: #3EB489;">Diagnosis</h2>
    <p class="text-center fw-semibold" style="color:#555;">
        Please follow the instructions below and upload the X-ray images to get the diagnosis result.
    </p>
    <p class="text-center fw-semibold" style="color:#777; font-size: 0.95rem;">
        <strong>Note:</strong> This system provides an estimated severity level of Knee Osteoarthritis. 
        It is not a replacement for medical advice. For accurate diagnosis, please consult a doctor.
    </p>

    <!-- Instructions -->
    <div class="card shadow-sm border-0 my-4">
        <div class="card-body" style="background-color: #E9F9F4; border-left: 6px solid #3EB489;">
            <h4 class="fw-bold mb-3" style="color: #3EB489;">Instructions</h4>
            <ul style="line-height: 1.8; font-size: 1.05rem; color:#333;">
                <li><strong>Step 1:</strong> Take radiographs of the knee in AnteroPosterior (AP) view. Crop the knee portion and resize it to <strong>299×299 pixels</strong>.</li>
                <li><strong>Step 2:</strong> Click on the <em>“Choose File”</em> button and upload the cropped knee radiographs from your device.</li>
                <li><strong>Step 3:</strong> After uploading, click on the <em>“Predict”</em> button to view results.</li>
            </ul>
        </div>
    </div>

    <!-- Upload Form -->
    <form method="POST" enctype="multipart/form-data" class="text-center">
        <input type="file" id="image-input" name="file" accept=".jpg,.jpeg,.png" onchange="previewImage()" class="form-control w-50 mx-auto mb-4">
        
        <div>
            <img id="image-preview" src="#" alt="Preview" class="img-fluid rounded shadow-sm mb-3" 
                 style="display: none; max-width: 300px; max-height: 300px;">
        </div>
        
        <button id="predict-btn" type="submit" class="btn btn-lg" 
                style="background-color: #3EB489; color: white; display: none;">
            Predict!
        </button>
    </form>

    <!-- Prediction Result -->
    {% if prediction_text %}
    <div class="text-center mt-4">
        <div class="alert alert-success d-inline-block shadow-sm">
            <span class="fw-bold" style="font-size: 1.1rem;">
                Prediction: {{ prediction_text }}
            </span>
        </div>
    </div>
    {% endif %}
</div>

<!-- Image Preview Script -->
<script src="{{ url_for('static', filename='js/main.js') }}" type="text/javascript"></script>
<script>
   function previewImage() {
       var reader = new FileReader();
       reader.onload = function(event) {
           var img = document.getElementById("image-preview");
           var btn = document.getElementById("predict-btn");
           img.src = event.target.result;
           img.style.display = "block";
           btn.style.display = "inline-block";
       };
       reader.readAsDataURL(event.target.files[0]);
   }
</script>
{% endblock %}
